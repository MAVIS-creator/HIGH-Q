# Enable URL rewriting
RewriteEngine On

# Error Documents
ErrorDocument 403 /public/403.php
ErrorDocument 404 /public/404.php
ErrorDocument 500 /public/500.php

# Collapse accidental duplicate /public/public paths to /public (environment-agnostic)
# THE_REQUEST ensures it only triggers on client requests, not internal rewrites
RewriteCond %{THE_REQUEST} \s/public/public/ [NC]
RewriteRule ^public/(.*)$ /public/$1 [L,R=301]

# If the requested file or folder actually exists, serve it directly
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Otherwise, route everything to index.php
RewriteRule ^ index.php [L]
