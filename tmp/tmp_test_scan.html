<!DOCTYPE html>
<html>
<head>
    <title>Scan Engine Test</title>
    <style>
        body { font-family: Arial; max-width: 1000px; margin: 20px auto; }
        .button { padding: 10px 20px; margin: 5px; cursor: pointer; background: #007bff; color: white; border: none; }
        .progress { width: 100%; height: 20px; background: #eee; border-radius: 5px; margin: 10px 0; }
        .bar { height: 100%; background: #28a745; width: 0%; transition: width 0.3s; }
        .results { margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 5px; }
        .critical { color: #dc3545; font-weight: bold; }
        .warning { color: #ff9800; }
        .info { color: #17a2b8; }
    </style>
</head>
<body>
    <h1>üîí Security Scan Engine Test</h1>
    <p>Click a button to test different scan types:</p>
    
    <button class="button" onclick="startScan('quick')">‚ö° Quick Scan</button>
    <button class="button" onclick="startScan('full')">üîç Full Scan</button>
    <button class="button" onclick="startScan('malware')">ü¶† Malware Scan</button>
    
    <div class="progress"><div class="bar" id="progressBar"></div></div>
    <div id="results" class="results" style="display:none;"></div>

    <script>
        async function startScan(type) {
            const resultsDiv = document.getElementById('results');
            const bar = document.getElementById('progressBar');
            
            resultsDiv.style.display = 'none';
            bar.style.width = '0%';
            
            try {
                bar.style.width = '20%';
                
                const response = await fetch('../admin/api/scan-engine.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: 'scan_type=' + encodeURIComponent(type)
                });
                
                bar.style.width = '60%';
                const data = await response.json();
                bar.style.width = '90%';
                
                displayResults(data);
                bar.style.width = '100%';
                
            } catch (error) {
                resultsDiv.innerHTML = '<div class="critical">Error: ' + error.message + '</div>';
                resultsDiv.style.display = 'block';
            }
        }
        
        function displayResults(data) {
            const resultsDiv = document.getElementById('results');
            let html = `<h2>Scan Results: ${data.report.scan_type}</h2>`;
            html += `<p><strong>Status:</strong> ${data.status}</p>`;
            html += `<p><strong>Files Scanned:</strong> ${data.report.totals.files_scanned}</p>`;
            html += `<p class="critical"><strong>Critical Issues:</strong> ${data.report.critical.length}</p>`;
            html += `<p class="warning"><strong>Warnings:</strong> ${data.report.warnings.length}</p>`;
            html += `<p class="info"><strong>Info Messages:</strong> ${data.report.info.length}</p>`;
            
            if (data.report.critical.length > 0) {
                html += '<h3>Critical Issues (first 5):</h3><ul>';
                data.report.critical.slice(0, 5).forEach(issue => {
                    html += `<li class="critical">${issue.message} (${issue.file})</li>`;
                });
                html += '</ul>';
            }
            
            if (data.report.warnings.length > 0) {
                html += '<h3>Warnings (first 5):</h3><ul>';
                data.report.warnings.slice(0, 5).forEach(warning => {
                    html += `<li class="warning">${warning.message} ${warning.file ? '(' + warning.file + ')' : ''}</li>`;
                });
                html += '</ul>';
            }
            
            resultsDiv.innerHTML = html;
            resultsDiv.style.display = 'block';
        }
    </script>
</body>
</html>
